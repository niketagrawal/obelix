<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>obelix.run_workflow &mdash; obelix 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=fd3f3429" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=01f34227"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            obelix
          </a>
              <div class="version">
                0.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../autoapi/index.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">obelix</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">obelix.run_workflow</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for obelix.run_workflow</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">chemspax.main</span> <span class="kn">import</span> <span class="n">main</span> <span class="k">as</span> <span class="n">chemspax_main</span>
<span class="kn">from</span> <span class="nn">chemspax.utilities</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">obelix.tools.utilities</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">obelix.descriptor_calculator</span> <span class="kn">import</span> <span class="n">Descriptors</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">mace</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">morfeus</span> <span class="k">as</span> <span class="nn">mf</span>
<span class="kn">from</span> <span class="nn">morfeus.conformer</span> <span class="kn">import</span> <span class="n">ConformerEnsemble</span>
<span class="kn">from</span> <span class="nn">morfeus</span> <span class="kn">import</span> <span class="n">BiteAngle</span><span class="p">,</span> <span class="n">ConeAngle</span><span class="p">,</span> <span class="n">BuriedVolume</span><span class="p">,</span> <span class="n">Dispersion</span><span class="p">,</span> <span class="n">SASA</span><span class="p">,</span> <span class="n">read_xyz</span>
<span class="c1"># from xtb.utils import get_method</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">openbabel</span> <span class="kn">import</span> <span class="n">openbabel</span>
<span class="kn">from</span> <span class="nn">obelix.molecular_graph</span> <span class="kn">import</span> <span class="n">molecular_graph</span>
<span class="kn">from</span> <span class="nn">rdkit</span> <span class="kn">import</span> <span class="n">RDLogger</span>
<span class="n">RDLogger</span><span class="o">.</span><span class="n">DisableLog</span><span class="p">(</span><span class="s1">&#39;rdApp.info&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="MACE">
<a class="viewcode-back" href="../../autoapi/obelix/run_workflow/index.html#obelix.run_workflow.MACE">[docs]</a>
<span class="k">class</span> <span class="nc">MACE</span><span class="p">:</span>   
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bidentate</span><span class="p">,</span> <span class="n">CA</span><span class="p">,</span> <span class="n">name_of_xyz</span><span class="p">):</span>
        <span class="c1"># Declare instances of the class (a.k.a self variable)</span>
<div class="viewcode-block" id="MACE.CA">
<a class="viewcode-back" href="../../autoapi/obelix/run_workflow/index.html#obelix.run_workflow.MACE.CA">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">CA</span> <span class="o">=</span> <span class="n">CA</span></div>

<div class="viewcode-block" id="MACE.name_of_xyz">
<a class="viewcode-back" href="../../autoapi/obelix/run_workflow/index.html#obelix.run_workflow.MACE.name_of_xyz">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_of_xyz</span> <span class="o">=</span> <span class="n">name_of_xyz</span></div>

<div class="viewcode-block" id="MACE.bidentate">
<a class="viewcode-back" href="../../autoapi/obelix/run_workflow/index.html#obelix.run_workflow.MACE.bidentate">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">bidentate</span> <span class="o">=</span> <span class="n">bidentate</span></div>


    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="MACE.find_bidentate">
<a class="viewcode-back" href="../../autoapi/obelix/run_workflow/index.html#obelix.run_workflow.MACE.find_bidentate">[docs]</a>
    <span class="k">def</span> <span class="nf">find_bidentate</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">metal_atom_atomic_number</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find indices of bidentate ligand if functions implemented in MACE class are not working or if</span>
<span class="sd">        structure was made manually and there is no mapped SMILES string</span>

<span class="sd">        Args:</span>
<span class="sd">            mol: RDKit mol object</span>
<span class="sd">            metal_atom_atomic_number:</span>

<span class="sd">        Returns: list of bidentate atom indices</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bidentate_idxs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># find bidentate indices for first conformer, they should be the same for all conformers</span>
            <span class="c1"># in case of SP we only need to find metal atom and neighbours since only one cycle with metal center is possible</span>
            <span class="n">metal_atom</span> <span class="o">=</span> <span class="p">[</span><span class="n">atom</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">()</span> <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">GetAtomicNum</span><span class="p">()</span> <span class="o">==</span> <span class="n">metal_atom_atomic_number</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">metal_bonds</span> <span class="o">=</span> <span class="p">[</span><span class="n">bond</span> <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">metal_atom</span><span class="o">.</span><span class="n">GetBonds</span><span class="p">()]</span>
            <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">metal_bonds</span><span class="p">:</span>
                <span class="c1"># atoms that are connected to the metal and in the bidentate cycle are the bidentate atoms</span>
                <span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span> <span class="o">=</span> <span class="n">bond</span><span class="o">.</span><span class="n">GetBeginAtomIdx</span><span class="p">(),</span> <span class="n">bond</span><span class="o">.</span><span class="n">GetEndAtomIdx</span><span class="p">()</span>
                <span class="n">bidentate_idxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx1</span><span class="p">)</span> <span class="k">if</span> <span class="n">idx1</span> <span class="o">!=</span> <span class="n">metal_atom</span><span class="o">.</span><span class="n">GetIdx</span><span class="p">()</span> <span class="k">else</span> <span class="n">bidentate_idxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx2</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># ToDo: add logging</span>
            <span class="c1"># go on to next conformer and try again</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">bidentate_idxs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">metal_atom</span><span class="o">.</span><span class="n">GetIdX</span><span class="p">(),</span> <span class="n">bidentate_idxs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>


<div class="viewcode-block" id="MACE.generate_complex_SP_xyz">
<a class="viewcode-back" href="../../autoapi/obelix/run_workflow/index.html#obelix.run_workflow.MACE.generate_complex_SP_xyz">[docs]</a>
    <span class="k">def</span> <span class="nf">generate_complex_SP_xyz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auxiliary_ligands</span> <span class="o">=</span> <span class="p">[]):</span>
        <span class="n">geom</span> <span class="o">=</span> <span class="s1">&#39;SP&#39;</span>
        <span class="n">ligands</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bidentate</span><span class="p">]</span>
        <span class="n">ligands</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">auxiliary_ligands</span><span class="p">)</span>
        <span class="n">core</span> <span class="o">=</span> <span class="n">mace</span><span class="o">.</span><span class="n">ComplexFromLigands</span><span class="p">(</span><span class="n">ligands</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CA</span><span class="p">,</span> <span class="n">geom</span><span class="p">)</span>
        <span class="n">Xs</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">GetStereomers</span><span class="p">(</span><span class="n">regime</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">dropEnantiomers</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># bidentate_idxs = []  # the final bidentate cycle indices</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">X</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Xs</span><span class="p">):</span>
            <span class="n">X</span><span class="o">.</span><span class="n">AddConformers</span><span class="p">(</span><span class="n">numConfs</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>   
            <span class="n">X</span><span class="o">.</span><span class="n">ToXYZ</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CA</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.xyz&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name_of_xyz</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span> <span class="n">confId</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>
        <span class="n">ligands</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bidentate</span><span class="p">)</span>
        <span class="c1">#     if len(bidentate_idxs) == 0:</span>
        <span class="c1">#         try:</span>
        <span class="c1">#             # find bidentate indices for first conformer, they should be the same for all conformers</span>
        <span class="c1">#             # in case of SP we only need to find metal atom and neighbours since only one cycle with metal center is possible</span>
        <span class="c1">#             atomic_number_metal_center = Chem.MolFromSmiles(self.CA).GetAtomWithIdx(0).GetAtomicNum()</span>
        <span class="c1">#             metal_atom = [atom for atom in X.mol3D.GetAtoms() if atom.GetAtomicNum() == atomic_number_metal_center][0]</span>
        <span class="c1">#             metal_bonds = [bond for bond in metal_atom.GetBonds()]</span>
        <span class="c1">#             for bond in metal_bonds:</span>
        <span class="c1">#                 # atoms that are connected to the metal and in the bidentate cycle are the bidentate atoms</span>
        <span class="c1">#                 idx1, idx2 = bond.GetBeginAtomIdx(), bond.GetEndAtomIdx()</span>
        <span class="c1">#                 bidentate_idxs.append(idx1) if idx1 != metal_atom.GetIdx() else bidentate_idxs.append(idx2)</span>

        <span class="c1">#         except Exception as e:</span>
        <span class="c1">#             # ToDo: add logging</span>
        <span class="c1">#             # go on to next conformer and try again</span>
        <span class="c1">#             continue</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">Xs</span><span class="p">)</span></div>

        <span class="c1"># return bidentate_idxs[0], metal_atom.GetIdX(), bidentate_idxs[1]</span>

<div class="viewcode-block" id="MACE.generate_complex_OH_xyz">
<a class="viewcode-back" href="../../autoapi/obelix/run_workflow/index.html#obelix.run_workflow.MACE.generate_complex_OH_xyz">[docs]</a>
    <span class="k">def</span> <span class="nf">generate_complex_OH_xyz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auxiliary_ligands</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">substrate</span> <span class="o">=</span> <span class="p">[]):</span>
        <span class="n">geom</span> <span class="o">=</span> <span class="s1">&#39;OH&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Check if auxiliary ligands and substrate are present</span>
            <span class="k">if</span> <span class="n">auxiliary_ligands</span> <span class="o">==</span> <span class="p">[]</span> <span class="ow">and</span> <span class="n">substrate</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">auxiliary_ligands</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;[H-:1]&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span>
            <span class="k">if</span> <span class="n">auxiliary_ligands</span> <span class="o">==</span> <span class="p">[]</span> <span class="ow">and</span> <span class="n">substrate</span> <span class="o">!=</span> <span class="p">[]:</span>
                <span class="n">auxiliary_ligands</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;[H-:1]&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span>
            
            <span class="n">auxiliary</span> <span class="o">=</span> <span class="n">auxiliary_ligands</span>
            
            <span class="k">if</span> <span class="n">substrate</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">auxiliary</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">bidentate</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">auxiliary</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">bidentate</span><span class="p">,</span> <span class="n">substrate</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="n">core</span> <span class="o">=</span> <span class="n">mace</span><span class="o">.</span><span class="n">ComplexFromLigands</span><span class="p">(</span><span class="n">auxiliary</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CA</span><span class="p">,</span> <span class="n">geom</span><span class="p">)</span>
            <span class="n">Xs</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">GetStereomers</span><span class="p">(</span><span class="n">regime</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">dropEnantiomers</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">bidentate_cycle_idxs</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># all cycles that could possibly be the metal-bidentate cycle</span>
            <span class="n">bidentate_idxs</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># the final bidentate cycle indices</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">X</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Xs</span><span class="p">):</span>
                <span class="n">X</span><span class="o">.</span><span class="n">AddConformers</span><span class="p">(</span><span class="n">numConfs</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>   
                <span class="n">X</span><span class="o">.</span><span class="n">ToXYZ</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CA</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">.xyz&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name_of_xyz</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span> <span class="n">confId</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in MACE: &#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

        <span class="n">auxiliary</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bidentate</span><span class="p">)</span>
        <span class="n">auxiliary</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">substrate</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>
</div>

        <span class="c1">#     # find bidentate indices on the conformer if none were yet</span>
        <span class="c1">#     if len(bidentate_idxs) == 0:</span>
        <span class="c1">#         try:</span>
        <span class="c1">#             # get all mapped (donor) atom indices</span>
        <span class="c1">#             donor_atoms = [atom.GetIdx() for atom in X.mol3D.GetAtoms() if atom.GetAtomMapNum()]</span>
        <span class="c1">#             # smallest set of simple rings containing at least two mapped atoms</span>
        <span class="c1">#             # Chem.GetSSSR() is updated in rdkit 2020.09.1, versions before had to use Chem.GetSymmSSSR()</span>
        <span class="c1">#             atoms_of_smallest_rings = [list(idx) for idx in Chem.GetSSSR(X.mol3D)]</span>
        <span class="c1">#             for list_idxs in atoms_of_smallest_rings:</span>
        <span class="c1">#                 # if at least two mapped atoms are in the ring it&#39;s a multidentate ligand</span>
        <span class="c1">#                 if check_if_at_least_two_mapped_atoms_in_ring(donor_atoms, list_idxs):</span>
        <span class="c1">#                     bidentate_cycle_idxs = list_idxs</span>
        <span class="c1">#                     break</span>

        <span class="c1">#             # find metal atom and neighbours</span>
        <span class="c1">#             atomic_number_metal_center = Chem.MolFromSmiles(self.CA).GetAtomWithIdx(0).GetAtomicNum()</span>
        <span class="c1">#             metal_atom = [atom for atom in X.mol3D.GetAtoms() if atom.GetAtomicNum() == atomic_number_metal_center][0]</span>
        <span class="c1">#             metal_bonds = [bond for bond in metal_atom.GetBonds()]</span>
        <span class="c1">#             for bond in metal_bonds:</span>
        <span class="c1">#                 # atoms that are connected to the metal and in the bidentate cycle are the bidentate atoms</span>
        <span class="c1">#                 idx1, idx2 = bond.GetBeginAtomIdx(), bond.GetEndAtomIdx()</span>
        <span class="c1">#                 if idx1 == metal_atom.GetIdx() and idx2 in bidentate_cycle_idxs:</span>
        <span class="c1">#                     bidentate_idxs.append(idx2)</span>
        <span class="c1">#                 elif idx1 in bidentate_cycle_idxs and idx2 == metal_atom.GetIdx():</span>
        <span class="c1">#                     bidentate_idxs.append(idx1)</span>

        <span class="c1">#         except Exception as e:</span>
        <span class="c1">#             # ToDo: add logging</span>
        <span class="c1">#             # go on to next conformer and try again</span>
        <span class="c1">#             continue</span>

        <span class="c1"># return bidentate_idxs[0], metal_atom.GetIdX(), bidentate_idxs[1]</span>
            

<div class="viewcode-block" id="Workflow">
<a class="viewcode-back" href="../../autoapi/obelix/run_workflow/index.html#obelix.run_workflow.Workflow">[docs]</a>
<span class="k">class</span> <span class="nc">Workflow</span><span class="p">:</span>
    
    <span class="c1">#### Initialize</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mace_input</span><span class="o">=</span><span class="p">[],</span> <span class="n">chemspax_input</span><span class="o">=</span><span class="p">[],</span> <span class="n">crest_input</span><span class="o">=</span><span class="p">[],</span> <span class="n">path_to_workflow</span><span class="o">=</span><span class="p">[],</span> <span class="n">descriptor_calculator_input</span><span class="o">=</span><span class="p">[],</span> <span class="n">geom</span><span class="o">=</span><span class="s1">&#39;SP&#39;</span><span class="p">):</span>
        
<div class="viewcode-block" id="Workflow.mace_input">
<a class="viewcode-back" href="../../autoapi/obelix/run_workflow/index.html#obelix.run_workflow.Workflow.mace_input">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">mace_input</span> <span class="o">=</span> <span class="n">mace_input</span></div>

<div class="viewcode-block" id="Workflow.chemspax_input">
<a class="viewcode-back" href="../../autoapi/obelix/run_workflow/index.html#obelix.run_workflow.Workflow.chemspax_input">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">chemspax_input</span> <span class="o">=</span> <span class="n">chemspax_input</span></div>

<div class="viewcode-block" id="Workflow.crest_input">
<a class="viewcode-back" href="../../autoapi/obelix/run_workflow/index.html#obelix.run_workflow.Workflow.crest_input">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">crest_input</span> <span class="o">=</span> <span class="n">crest_input</span></div>

<div class="viewcode-block" id="Workflow.path_to_workflow">
<a class="viewcode-back" href="../../autoapi/obelix/run_workflow/index.html#obelix.run_workflow.Workflow.path_to_workflow">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">path_to_workflow</span> <span class="o">=</span> <span class="n">path_to_workflow</span></div>

<div class="viewcode-block" id="Workflow.descriptor_calculator_input">
<a class="viewcode-back" href="../../autoapi/obelix/run_workflow/index.html#obelix.run_workflow.Workflow.descriptor_calculator_input">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">descriptor_calculator_input</span> <span class="o">=</span> <span class="n">descriptor_calculator_input</span></div>


<div class="viewcode-block" id="Workflow.bidentate_1_index">
<a class="viewcode-back" href="../../autoapi/obelix/run_workflow/index.html#obelix.run_workflow.Workflow.bidentate_1_index">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">bidentate_1_index</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Workflow.bidentate_2_index">
<a class="viewcode-back" href="../../autoapi/obelix/run_workflow/index.html#obelix.run_workflow.Workflow.bidentate_2_index">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">bidentate_2_index</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Workflow.metal_index">
<a class="viewcode-back" href="../../autoapi/obelix/run_workflow/index.html#obelix.run_workflow.Workflow.metal_index">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">metal_index</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Workflow.mace_skeletons">
<a class="viewcode-back" href="../../autoapi/obelix/run_workflow/index.html#obelix.run_workflow.Workflow.mace_skeletons">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">mace_skeletons</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span></div>

        <span class="c1"># Unpack inputs of MACE, Chemspax, CREST</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Workflow is initializing. Converting your dict. input to variables.&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="Workflow.geom">
<a class="viewcode-back" href="../../autoapi/obelix/run_workflow/index.html#obelix.run_workflow.Workflow.geom">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">geom</span> <span class="o">=</span> <span class="n">geom</span></div>

<div class="viewcode-block" id="Workflow.solvent">
<a class="viewcode-back" href="../../autoapi/obelix/run_workflow/index.html#obelix.run_workflow.Workflow.solvent">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">solvent</span> <span class="o">=</span> <span class="kc">None</span></div>

        <span class="k">if</span> <span class="n">mace_input</span> <span class="o">!=</span> <span class="p">[]:</span>  
          <span class="bp">self</span><span class="o">.</span><span class="n">mace_ligands</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">auxiliary_ligands</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">central_atom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">names_of_xyz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">substrate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialize_mace</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">chemspax_input</span> <span class="o">!=</span> <span class="p">[]:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">substituent_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_to_database</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_to_substituents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialize_chemspax</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">crest_input</span> <span class="o">!=</span> <span class="p">[]:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_of_complex</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">solvent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf_search</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialize_crest</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">descriptor_calculator_input</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">descriptor_central_atom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptor_metal_adduct</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptor_output_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_xyz_from_log</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptor_printout</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptor_solvent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialize_descriptor_calculator</span><span class="p">()</span>
              
<div class="viewcode-block" id="Workflow.initialize_mace">
<a class="viewcode-back" href="../../autoapi/obelix/run_workflow/index.html#obelix.run_workflow.Workflow.initialize_mace">[docs]</a>
    <span class="k">def</span> <span class="nf">initialize_mace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reading MACE inputs&#39;</span><span class="p">)</span>
        
        <span class="n">bidentate</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mace_input</span><span class="p">[</span><span class="s1">&#39;bidentate_ligands&#39;</span><span class="p">])</span>
        <span class="c1">#bidentate = list(pd.read_excel(self.mace_input[&#39;bidentate_ligands&#39;])[&#39;smiles&#39;])</span>
        <span class="n">auxiliary_ligands</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mace_input</span><span class="p">[</span><span class="s1">&#39;auxiliary_ligands&#39;</span><span class="p">]</span>
        <span class="n">geom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mace_input</span><span class="p">[</span><span class="s1">&#39;geom&#39;</span><span class="p">]</span>
        <span class="n">central_atom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mace_input</span><span class="p">[</span><span class="s1">&#39;central_atom&#39;</span><span class="p">]</span>
        <span class="n">names_of_xyz_key</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mace_input</span><span class="p">[</span><span class="s1">&#39;names_of_xyz&#39;</span><span class="p">])</span>
        <span class="c1">#names_of_xyz_key = list(pd.read_excel(self.mace_input[&#39;bidentate_ligands&#39;])[&#39;Name&#39;])</span>
        <span class="n">substrate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mace_input</span><span class="p">[</span><span class="s1">&#39;substrate&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">bidentate</span><span class="p">,</span> <span class="n">auxiliary_ligands</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">central_atom</span><span class="p">,</span> <span class="n">names_of_xyz_key</span><span class="p">,</span> <span class="n">substrate</span></div>

      
<div class="viewcode-block" id="Workflow.initialize_chemspax">
<a class="viewcode-back" href="../../autoapi/obelix/run_workflow/index.html#obelix.run_workflow.Workflow.initialize_chemspax">[docs]</a>
    <span class="k">def</span> <span class="nf">initialize_chemspax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reading ChemSpaX inputs&#39;</span><span class="p">)</span>

        <span class="n">substituent_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chemspax_input</span><span class="p">[</span><span class="s1">&#39;substituent_list&#39;</span><span class="p">]</span>
        <span class="c1"># assume that this path is always at the base of the chemspax package, so substituents are read from there</span>
        <span class="n">path_to_substituents</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span> <span class="s1">&#39;chemspax&#39;</span><span class="p">,</span> <span class="s1">&#39;chemspax&#39;</span><span class="p">,</span> <span class="s1">&#39;substituents_xyz&#39;</span><span class="p">,</span> <span class="s1">&#39;manually_generated&#39;</span><span class="p">)</span>
        <span class="n">path_to_database</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_substituents</span><span class="p">,</span> <span class="s2">&quot;central_atom_centroid_database.csv&quot;</span><span class="p">)</span>
        <span class="c1"># path_to_database = self.chemspax_input[&#39;path_to_database&#39;]</span>
        <span class="c1"># path_to_substituents = self.chemspax_input[&#39;path_to_substituents&#39;]</span>
        
        <span class="k">return</span> <span class="n">substituent_list</span><span class="p">,</span> <span class="n">path_to_database</span><span class="p">,</span> <span class="n">path_to_substituents</span></div>

    
<div class="viewcode-block" id="Workflow.initialize_crest">
<a class="viewcode-back" href="../../autoapi/obelix/run_workflow/index.html#obelix.run_workflow.Workflow.initialize_crest">[docs]</a>
    <span class="k">def</span> <span class="nf">initialize_crest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reading CREST inputs.&#39;</span><span class="p">)</span>
        
        <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crest_input</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span>
        <span class="n">multiplicity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crest_input</span><span class="p">[</span><span class="s1">&#39;multiplicity&#39;</span><span class="p">]</span>
        <span class="n">charge_of_complex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crest_input</span><span class="p">[</span><span class="s1">&#39;charge_complex&#39;</span><span class="p">]</span>
        <span class="n">solvent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crest_input</span><span class="p">[</span><span class="s1">&#39;solvent&#39;</span><span class="p">]</span>
        <span class="n">conf_search</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crest_input</span><span class="p">[</span><span class="s1">&#39;conformer_search&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">method</span><span class="p">,</span> <span class="n">charge_of_complex</span><span class="p">,</span> <span class="n">multiplicity</span><span class="p">,</span> <span class="n">solvent</span><span class="p">,</span> <span class="n">conf_search</span></div>


<div class="viewcode-block" id="Workflow.initialize_descriptor_calculator">
<a class="viewcode-back" href="../../autoapi/obelix/run_workflow/index.html#obelix.run_workflow.Workflow.initialize_descriptor_calculator">[docs]</a>
    <span class="k">def</span> <span class="nf">initialize_descriptor_calculator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reading Descriptor Calculator inputs.&#39;</span><span class="p">)</span>
        <span class="n">descriptor_central_atom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptor_calculator_input</span><span class="p">[</span><span class="s1">&#39;central_atom&#39;</span><span class="p">]</span>
        <span class="n">descriptor_metal_adduct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptor_calculator_input</span><span class="p">[</span><span class="s1">&#39;metal_adduct&#39;</span><span class="p">]</span>
        <span class="n">descriptor_output_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptor_calculator_input</span><span class="p">[</span><span class="s1">&#39;output_type&#39;</span><span class="p">]</span>
        <span class="n">extract_xyz_from_log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptor_calculator_input</span><span class="p">[</span><span class="s1">&#39;extract_xyz_from_log&#39;</span><span class="p">]</span>
        <span class="n">descriptor_printout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptor_calculator_input</span><span class="p">[</span><span class="s1">&#39;descriptor_printout&#39;</span><span class="p">]</span>
        <span class="n">descriptor_solvent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptor_calculator_input</span><span class="p">[</span><span class="s1">&#39;solvent&#39;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">descriptor_central_atom</span><span class="p">,</span> <span class="n">descriptor_metal_adduct</span><span class="p">,</span> <span class="n">descriptor_output_type</span><span class="p">,</span> <span class="n">extract_xyz_from_log</span><span class="p">,</span> <span class="n">descriptor_printout</span><span class="p">,</span> <span class="n">descriptor_solvent</span></div>


<div class="viewcode-block" id="Workflow.prepare_folder_structure">
<a class="viewcode-back" href="../../autoapi/obelix/run_workflow/index.html#obelix.run_workflow.Workflow.prepare_folder_structure">[docs]</a>
    <span class="k">def</span> <span class="nf">prepare_folder_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Preparing the folder structure&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_workflow</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_workflow</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_workflow</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;MACE&#39;</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;MACE&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;ChemSpaX&#39;</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;ChemSpaX&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;CREST&#39;</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;CREST&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;Descriptors&#39;</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;Descriptors&#39;</span><span class="p">)</span> 
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_workflow</span><span class="p">)</span></div>


<div class="viewcode-block" id="Workflow.run_mace">
<a class="viewcode-back" href="../../autoapi/obelix/run_workflow/index.html#obelix.run_workflow.Workflow.run_mace">[docs]</a>
    <span class="k">def</span> <span class="nf">run_mace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_workflow</span><span class="p">,</span> <span class="s1">&#39;MACE&#39;</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mace_ligands</span><span class="p">))):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geom</span> <span class="o">==</span> <span class="s1">&#39;OH&#39;</span><span class="p">:</span>
                    <span class="n">identifier_OH</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">names_of_xyz</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_OH&#39;</span>
                    <span class="nb">complex</span> <span class="o">=</span> <span class="n">MACE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mace_ligands</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">central_atom</span><span class="p">,</span>  <span class="n">identifier_OH</span><span class="p">)</span>
                    <span class="nb">complex</span><span class="o">.</span><span class="n">generate_complex_OH_xyz</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auxiliary_ligands</span><span class="p">,</span> <span class="n">substrate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">substrate</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geom</span> <span class="o">==</span> <span class="s1">&#39;SP&#39;</span><span class="p">:</span>
                    <span class="n">identifier_SP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">names_of_xyz</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_SP&#39;</span>
                    <span class="nb">complex</span> <span class="o">=</span> <span class="n">MACE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mace_ligands</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">central_atom</span><span class="p">,</span> <span class="n">identifier_SP</span><span class="p">)</span>
                    <span class="n">Xs</span> <span class="o">=</span> <span class="nb">complex</span><span class="o">.</span><span class="n">generate_complex_SP_xyz</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auxiliary_ligands</span><span class="p">)</span>
                    <span class="c1"># j index - conformer index</span>
                    <span class="c1"># i index - ligand index</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Xs</span><span class="p">):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">names_of_xyz</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mace_skeletons</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">mace_skeletons</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">names_of_xyz</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">central_atom</span><span class="p">,</span> <span class="n">identifier_SP</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.xyz&#39;</span><span class="p">]))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">mace_skeletons</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">names_of_xyz</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">central_atom</span><span class="p">,</span> <span class="n">identifier_SP</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.xyz&#39;</span><span class="p">])]</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrong SMILES:&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>               </div>


<div class="viewcode-block" id="Workflow.run_chemspax">
<a class="viewcode-back" href="../../autoapi/obelix/run_workflow/index.html#obelix.run_workflow.Workflow.run_chemspax">[docs]</a>
    <span class="k">def</span> <span class="nf">run_chemspax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">functionalization_list</span><span class="p">):</span>  
<span class="w">        </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        </span>
<span class="sd">        Run chemspax from the pip installable package chemspax.</span>
<span class="sd">        Use prepare_data(...) to prepare the substituents.</span>
<span class="sd">        Then run main(...) to functionalize the skeletons prepared by MACE.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MACE scaffolds: &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">mace_skeletons</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">merged_mace_skeletons</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mace_skeletons</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="p">[])</span>
        
        <span class="n">chemspax_working_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_workflow</span><span class="p">,</span> <span class="s1">&#39;ChemSpaX&#39;</span><span class="p">)</span>
        
        <span class="c1"># Export MACE skeletons to ChemSpaX</span>
        
        <span class="n">src_dir_skeletons</span> <span class="o">=</span>  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_workflow</span><span class="p">,</span> <span class="s1">&#39;MACE&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">substituent_list</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">dest_dir_skeletons</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_workflow</span><span class="p">,</span> <span class="s1">&#39;ChemSpaX&#39;</span><span class="p">,</span> <span class="s1">&#39;chemspax_output&#39;</span><span class="p">)</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">src_dir_skeletons</span><span class="p">,</span> <span class="n">dest_dir_skeletons</span><span class="p">)</span>  

        <span class="k">else</span><span class="p">:</span>              
            <span class="n">dest_dir_skeletons</span> <span class="o">=</span>  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_workflow</span><span class="p">,</span> <span class="s1">&#39;ChemSpaX&#39;</span><span class="p">,</span> <span class="s1">&#39;skeletons&#39;</span><span class="p">)</span>        
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dest_dir_skeletons</span><span class="p">):</span>      
                <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">src_dir_skeletons</span><span class="p">,</span> <span class="n">dest_dir_skeletons</span><span class="p">)</span>            
            <span class="n">skeleton_list</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_workflow</span> <span class="p">,</span> <span class="s1">&#39;ChemSpaX&#39;</span><span class="p">,</span> <span class="s1">&#39;skeletons&#39;</span><span class="p">,</span><span class="s1">&#39;*.xyz&#39;</span><span class="p">))</span>
        
            <span class="k">for</span> <span class="n">xyz_file</span> <span class="ow">in</span> <span class="n">skeleton_list</span><span class="p">:</span>
                <span class="n">change_second_line_xyz</span><span class="p">(</span><span class="n">xyz_file</span><span class="p">,</span> <span class="n">new_content</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="c1"># set skeleton path to ../ChemSpaX/skeletons        </span>
            <span class="n">path_to_skeletons</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">dest_dir_skeletons</span><span class="p">)</span>
            <span class="c1"># copy substituents from user source to ChemSpaX folder</span>
            <span class="c1"># src_dir_subs = os.path.join(os.path.dirname(os.path.abspath(__file__)), &#39;install&#39;, &#39;chemspax&#39;, &#39;chemspax&#39;, &#39;substituents_xyz&#39;, &#39;manually_generated&#39;)</span>
            <span class="c1"># src_dir_subs = self.path_to_substituents</span>
            <span class="c1"># dest_dir_subs = os.path.join(self.path_to_workflow, &#39;ChemSpaX&#39;, &#39;substituents_xyz&#39;)</span>
            
            <span class="c1"># if not os.path.exists(dest_dir_subs):</span>
            <span class="c1">#     shutil.copytree(src_dir_subs, dest_dir_subs)</span>

            <span class="c1"># Prepare data (from data_preparation.py in the chemspax package)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Data preparation has been performed.&#39;</span><span class="p">)</span>
            <span class="c1"># path_to_substituents = src_dir_subs</span>
            <span class="c1">#   prepare_data(path_to_substituents, path_to_skeletons, self.path_to_database)</span>

            <span class="c1"># Set path to output</span>
            <span class="n">path_to_output</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_workflow</span><span class="p">,</span> <span class="s1">&#39;ChemSpaX&#39;</span><span class="p">,</span><span class="s1">&#39;chemspax_output&#39;</span><span class="p">)</span>

            <span class="c1"># Run chemspax from main</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">sub_list</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">substituent_list</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">substituent_list</span><span class="p">)</span>
            <span class="c1">#### Run chemspax</span>

            <span class="c1">#### Convert mace_skeletons to full paths (chemspax format).</span>
            <span class="n">chemspax_skeletons</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_skeletons</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mace_skeletons</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="n">index</span><span class="p">]]]</span>

            <span class="n">chemspax_main</span><span class="p">(</span><span class="n">chemspax_skeletons</span><span class="p">,</span> <span class="n">sub_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_to_database</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_to_substituents</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_skeletons</span><span class="p">),</span> <span class="n">chemspax_working_directory</span><span class="p">,</span> <span class="n">path_to_output</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">skeleton</span> <span class="ow">in</span> <span class="n">chemspax_skeletons</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">skeleton</span><span class="p">)[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_func_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sub_list</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;.mol&#39;</span><span class="p">),</span> \
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">names</span><span class="p">)[</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_functionalization_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">functionalization_list</span><span class="p">[</span><span class="n">index</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;.mol&#39;</span><span class="p">))</span>

            <span class="c1">## Convert mol to xyz to keep the bonding information</span>
            <span class="n">obconversion</span> <span class="o">=</span> <span class="n">openbabel</span><span class="o">.</span><span class="n">OBConversion</span><span class="p">()</span>
            <span class="n">obconversion</span><span class="o">.</span><span class="n">SetInFormat</span><span class="p">(</span><span class="s1">&#39;mol&#39;</span><span class="p">)</span>
            <span class="n">obconversion</span><span class="o">.</span><span class="n">SetOutFormat</span><span class="p">(</span><span class="s1">&#39;xyz&#39;</span><span class="p">)</span>
            <span class="n">mol</span> <span class="o">=</span> <span class="n">openbabel</span><span class="o">.</span><span class="n">OBMol</span><span class="p">()</span>
            <span class="n">obconversion</span><span class="o">.</span><span class="n">ReadFile</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> \
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">names</span><span class="p">)[</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_functionalization_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">functionalization_list</span><span class="p">[</span><span class="n">index</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;.mol&#39;</span><span class="p">))</span>

            <span class="n">obconversion</span><span class="o">.</span><span class="n">WriteFile</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> \
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="n">names</span><span class="p">)[</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_functionalization_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">functionalization_list</span><span class="p">[</span><span class="n">index</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;.xyz&#39;</span><span class="p">))</span></div>


            <span class="c1"># for filename in glob.glob(os.path.join(self.path_to_workflow, &#39;ChemSpaX&#39;, &#39;chemspax_output&#39;, &#39;*_func_*&#39;)):</span>
            <span class="c1">#     os.remove(filename)</span>

<div class="viewcode-block" id="Workflow.run_crest">
<a class="viewcode-back" href="../../autoapi/obelix/run_workflow/index.html#obelix.run_workflow.Workflow.run_crest">[docs]</a>
    <span class="k">def</span> <span class="nf">run_crest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_to_complexes</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">path_to_output</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">conformer_search</span> <span class="o">=</span> <span class="s1">&#39;off&#39;</span><span class="p">):</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        </span>
<span class="sd">        This function is designed to either run conformer search with xtb preopt. or just xtb optimization.</span>
<span class="sd">        The subprocess.call is used to make a binary call from your ./bashrc file or any local path in your </span>
<span class="sd">        $PATH system variable.</span>
<span class="sd">        </span>
<span class="sd">        Files are stored in the users preferred place when you run the workflow in a modular way, or by design</span>
<span class="sd">        the results are stored in your Workflow/CREST folder.</span>

<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="k">if</span> <span class="n">path_to_complexes</span> <span class="o">==</span> <span class="p">[]:</span>
          <span class="n">path_to_complexes</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_workflow</span><span class="p">,</span> <span class="s1">&#39;ChemSpaX&#39;</span><span class="p">,</span> <span class="s1">&#39;chemspax_output&#39;</span><span class="p">)</span>
          <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_workflow</span><span class="p">)</span>

        
        <span class="k">for</span> <span class="n">path_to_complex</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_complexes</span><span class="p">,</span> <span class="s1">&#39;*.xyz&#39;</span><span class="p">)):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">path_to_complexes</span><span class="p">)</span>
            
            <span class="n">folder_name</span> <span class="o">=</span> <span class="n">path_to_complex</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">folder_name</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder_name</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;About to run </span><span class="si">{}</span><span class="s1">-xtb optimization:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">conformer_search</span> <span class="o">==</span> <span class="s1">&#39;on&#39;</span><span class="p">:</span>
                <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s1">&#39;xtb &quot;</span><span class="si">%s</span><span class="s1">&quot; --</span><span class="si">%s</span><span class="s1"> --chrg </span><span class="si">%s</span><span class="s1">  --uhf </span><span class="si">%s</span><span class="s1"> --alpb </span><span class="si">%s</span><span class="s1"> --opt &gt; xtb.out&#39;</span> \
                    <span class="o">%</span> <span class="p">(</span><span class="n">path_to_complex</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_of_complex</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">solvent</span><span class="p">),</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;About to RUN conformer search with CREST:&#39;</span><span class="p">)</span>
                
                <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s1">&#39;crest xtbopt.xyz --</span><span class="si">%s</span><span class="s1"> --chrg </span><span class="si">%s</span><span class="s1">  --uhf </span><span class="si">%s</span><span class="s1"> --alpb </span><span class="si">%s</span><span class="s1"> &gt; crest.out&#39;</span> \
                    <span class="o">%</span> <span class="p">(</span><span class="n">path_to_complex</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_of_complex</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">solvent</span><span class="p">),</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
       
            <span class="k">else</span><span class="p">:</span>
                <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s1">&#39;xtb &quot;</span><span class="si">%s</span><span class="s1">&quot; --</span><span class="si">%s</span><span class="s1"> --chrg </span><span class="si">%s</span><span class="s1">  --uhf </span><span class="si">%s</span><span class="s1"> --alpb </span><span class="si">%s</span><span class="s1"> --opt &gt; xtb.out&#39;</span> \
                    <span class="o">%</span> <span class="p">(</span><span class="n">path_to_complex</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_of_complex</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">solvent</span><span class="p">),</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            
            
            <span class="n">src_dir</span> <span class="o">=</span> <span class="n">path_to_complex</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="n">path_to_output</span> <span class="o">!=</span> <span class="p">[]:</span>
                <span class="n">dest_dir</span> <span class="o">=</span> <span class="n">path_to_output</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dest_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_workflow</span><span class="p">,</span> <span class="s1">&#39;CREST&#39;</span><span class="p">)</span>
            
            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">src_dir</span><span class="p">,</span> <span class="n">dest_dir</span><span class="p">)</span> 
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">path_to_complexes</span><span class="p">)</span>
        
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_workflow</span><span class="p">)</span></div>

            
<div class="viewcode-block" id="Workflow.calculate_descriptors">
<a class="viewcode-back" href="../../autoapi/obelix/run_workflow/index.html#obelix.run_workflow.Workflow.calculate_descriptors">[docs]</a>
    <span class="k">def</span> <span class="nf">calculate_descriptors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function uses the Descriptor class to calculate descriptors for xyz, CREST or log files. The output_type</span>
<span class="sd">        is used to determine which descriptors are calculated. The extract_xyz_from_log is used to extract the xyz</span>
<span class="sd">        coordinates from the log file. The printout is used to print the descriptors to the screen.</span>

<span class="sd">        By default, self.path_to_workflow is used as the path for the files to be read in.</span>
<span class="sd">        (so obelix/Workflow)</span>

<span class="sd">        :param metal_adduct: pristine, nbd are fully supported, acetonitrile is WIP</span>
<span class="sd">        :param output_type: xyz, crest or gaussian</span>
<span class="sd">        :param extract_xyz_from_log: True or False (only used for descriptors from gaussian output)</span>
<span class="sd">        :param printout: True or False (prints the descriptors to the screen)</span>
<span class="sd">        :return: dataframe of descriptors, calculated and loaded in the Descriptor class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">geom_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geom</span>
        <span class="c1"># fix the SP and BD confusion (they essentially mean the same thing, the structure is in SP coordination)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geom</span> <span class="o">==</span> <span class="s1">&#39;SP&#39;</span><span class="p">:</span>
            <span class="n">geom_type</span> <span class="o">=</span> <span class="s1">&#39;BD&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptor_output_type</span> <span class="o">==</span> <span class="s1">&#39;xyz&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptor_output_type</span> <span class="o">==</span> <span class="s1">&#39;crest&#39;</span><span class="p">:</span>
            <span class="n">descriptor_calculator</span> <span class="o">=</span> <span class="n">Descriptors</span><span class="p">(</span><span class="n">central_atom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">descriptor_central_atom</span><span class="p">,</span> <span class="n">path_to_workflow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_workflow</span><span class="p">,</span>
                                                <span class="n">output_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">descriptor_output_type</span><span class="p">)</span>

            <span class="n">descriptor_calculator</span><span class="o">.</span><span class="n">calculate_morfeus_descriptors</span><span class="p">(</span><span class="n">geom_type</span><span class="o">=</span><span class="n">geom_type</span><span class="p">,</span> <span class="n">solvent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">descriptor_solvent</span><span class="p">,</span>
                                                                <span class="n">printout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">descriptor_printout</span><span class="p">,</span> <span class="n">metal_adduct</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">descriptor_metal_adduct</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">descriptor_calculator</span><span class="o">.</span><span class="n">descriptor_df</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptor_output_type</span> <span class="o">==</span> <span class="s1">&#39;gaussian&#39;</span><span class="p">:</span>
            <span class="n">descriptor_calculator</span> <span class="o">=</span> <span class="n">Descriptors</span><span class="p">(</span><span class="n">central_atom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">descriptor_central_atom</span><span class="p">,</span> <span class="n">path_to_workflow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_workflow</span><span class="p">,</span>
                                                <span class="n">output_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">descriptor_output_type</span><span class="p">)</span>

            <span class="n">descriptor_calculator</span><span class="o">.</span><span class="n">calculate_dft_descriptors_from_log</span><span class="p">(</span><span class="n">geom_type</span><span class="o">=</span><span class="n">geom_type</span><span class="p">,</span> <span class="n">solvent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">descriptor_solvent</span><span class="p">,</span>
                                                                     <span class="n">extract_xyz_from_log</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">extract_xyz_from_log</span><span class="p">,</span>
                                                                     <span class="n">printout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">descriptor_printout</span><span class="p">,</span> <span class="n">metal_adduct</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">descriptor_metal_adduct</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Output type not recognized&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Workflow.run_workflow">
<a class="viewcode-back" href="../../autoapi/obelix/run_workflow/index.html#obelix.run_workflow.Workflow.run_workflow">[docs]</a>
    <span class="k">def</span> <span class="nf">run_workflow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_to_workflow</span> <span class="o">!=</span> <span class="p">[]:</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">prepare_folder_structure</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">run_mace</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_chemspax</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_crest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conf_search</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_descriptors</span><span class="p">()</span></div>
</div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    
<div class="viewcode-block" id="ligand_excel_file">
<a class="viewcode-back" href="../../autoapi/obelix/run_workflow/index.html#obelix.run_workflow.ligand_excel_file">[docs]</a>
    <span class="n">ligand_excel_file</span> <span class="o">=</span> <span class="s1">&#39;ligands_test.xlsx&#39;</span></div>

    <span class="n">auxiliary_ligands</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">substrate</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CC#[N:1]&#39;</span><span class="p">]</span>

    <span class="n">geom</span> <span class="o">=</span> <span class="s1">&#39;SP&#39;</span>
    <span class="n">central_atom</span> <span class="o">=</span> <span class="s1">&#39;[Ir+3]&#39;</span>
    <span class="n">names_of_xyz_key</span> <span class="o">=</span> <span class="s1">&#39;Cas&#39;</span>


    <span class="c1"># MACE input </span>
    <span class="n">mace_input</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bidentate_ligands&#39;</span><span class="p">:</span> <span class="n">ligand_excel_file</span><span class="p">,</span> 
                  <span class="s1">&#39;auxiliary_ligands&#39;</span><span class="p">:</span> <span class="n">auxiliary_ligands</span><span class="p">,</span> 
                  <span class="s1">&#39;names_of_xyz&#39;</span><span class="p">:</span> <span class="n">names_of_xyz_key</span><span class="p">,</span> 
                  <span class="s1">&#39;central_atom&#39;</span><span class="p">:</span> <span class="n">central_atom</span><span class="p">,</span> 
                  <span class="s1">&#39;geom&#39;</span><span class="p">:</span> <span class="n">geom</span><span class="p">,</span> 
                  <span class="s1">&#39;substrate&#39;</span><span class="p">:</span> <span class="n">substrate</span><span class="p">}</span>

    <span class="c1"># ChemXpaX input</span>
    
    <span class="c1"># current_directory = os.path.join(os.getcwd(), &quot;chemspax&quot;)  # use path.join()</span>
    <span class="c1"># # os.chdir(current_directory)</span>
    <span class="c1"># path_to_substituents = os.path.join(current_directory, &quot;substituents_xyz&quot;) </span>
    <span class="c1"># path_to_database = os.path.join(path_to_substituents, &quot;central_atom_centroid_database.csv&quot;)</span>
    <span class="c1"># substituent_df = pd.read_excel(&#39;new_dataset.xlsx&#39;).dropna()</span>
    <span class="c1"># substituent_list = np.array(substituent_df[[&#39;R1&#39;, &#39;R2&#39;, &#39;R3&#39;, &#39;R4&#39;]])</span>
    <span class="c1"># # print(substituent_list)</span>
    <span class="c1"># names = substituent_df[&#39;Name&#39;]</span>

    <span class="c1"># skeleton_list = list(substituent_df[&#39;Skeleton&#39;])</span>
    <span class="c1"># # print(skeleton_list)</span>
    <span class="c1"># path_to_hand_drawn_skeletons = os.path.join(current_directory, &quot;skeletons&quot;)</span>
    <span class="c1"># path_to_output = os.path.join(current_directory, &quot;complexes&quot;)</span>

    <span class="c1"># chemspax_input = {&#39;skeleton_list&#39; : skeleton_list, </span>
    <span class="c1">#                 &#39;substituent_list&#39; : substituent_list, </span>
    <span class="c1">#                 &#39;path_to_database&#39; : path_to_database, </span>
    <span class="c1">#                 &#39;path_to_substituents&#39; : path_to_substituents, </span>
    <span class="c1">#                 &#39;path_to_additional_skeletons&#39; : path_to_hand_drawn_skeletons}</span>


    <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;gfn2&#39;</span>
    <span class="n">charge_of_complex</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">multiplicity</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">solvent</span> <span class="o">=</span> <span class="s1">&#39;ch2cl2&#39;</span>
    
    <span class="n">crest_input</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span> 
                   <span class="s1">&#39;charge_complex&#39;</span><span class="p">:</span> <span class="n">charge_of_complex</span><span class="p">,</span>
                   <span class="s1">&#39;multiplicity&#39;</span> <span class="p">:</span> <span class="n">multiplicity</span><span class="p">,</span>
                   <span class="s1">&#39;solvent&#39;</span> <span class="p">:</span> <span class="n">solvent</span><span class="p">,</span>
                   <span class="s1">&#39;conformer_search&#39;</span> <span class="p">:</span> <span class="s1">&#39;off&#39;</span><span class="p">}</span>

    <span class="n">descriptor_central_atom</span> <span class="o">=</span> <span class="s1">&#39;Rh&#39;</span>
    <span class="n">descriptor_metal_adduct</span> <span class="o">=</span> <span class="s1">&#39;pristine&#39;</span>
    <span class="n">descriptor_output_type</span> <span class="o">=</span> <span class="s1">&#39;xyz&#39;</span>
    <span class="n">extract_xyz_from_log</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">descriptor_printout</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">descriptor_input</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;central_atom&#39;</span><span class="p">:</span> <span class="n">descriptor_central_atom</span><span class="p">,</span>
                        <span class="s1">&#39;metal_adduct&#39;</span><span class="p">:</span> <span class="n">descriptor_metal_adduct</span><span class="p">,</span>
                        <span class="s1">&#39;output_type&#39;</span><span class="p">:</span> <span class="n">descriptor_output_type</span><span class="p">,</span>
                        <span class="s1">&#39;extract_xyz_from_log&#39;</span><span class="p">:</span> <span class="n">extract_xyz_from_log</span><span class="p">,</span>
                        <span class="s1">&#39;descriptor_printout&#39;</span><span class="p">:</span> <span class="n">descriptor_printout</span><span class="p">,</span>
                        <span class="s1">&#39;solvent&#39;</span><span class="p">:</span> <span class="n">solvent</span><span class="p">}</span>

    <span class="c1"># print(skeleton_list)</span>
    <span class="n">workflow</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">(</span><span class="n">path_to_workflow</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;/Workflow&#39;</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="s1">&#39;SP&#39;</span><span class="p">,</span> <span class="n">descriptor_calculator_input</span><span class="o">=</span><span class="n">descriptor_input</span><span class="p">)</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">prepare_folder_structure</span><span class="p">()</span>
    <span class="c1"># descriptor_df = workflow.calculate_descriptors()</span>
    <span class="c1"># descriptor_df.to_csv(&#39;descriptor_df_test.csv&#39;, index=False)</span>
    <span class="c1"># workflow.run_chemspax(names=names ,functionalization_list=skeleton_list)</span>
    
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, TU Delft.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>